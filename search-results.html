<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Search Results - TravelBook</title>
    <script src="config.js"></script>
<script src="api-service.js"></script>
<script src="details-service.js"></script>
<script src="search-service.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
        background-color: #f5f5f5;
        color: #333;
        line-height: 1.6;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
    }

    /* Header Styles */
    header {
        background-color: #fff;
        color: white;
        padding: 15px 0;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        text-decoration: none;
    }
    a{
        text-decoration: none;  
    }

    .logo {
        font-size: 24px;
        font-weight: bold;
    }

    .logo a {
        color: white;
        text-decoration: none;
    }

    .logo span {
        color: #0071c2;
    }

    nav ul {
        display: flex;
        list-style: none;
    }

    nav ul li {
        margin-left: 20px;
    }

    nav ul li a {
        color: white;
        text-decoration: none;
        font-weight: 500;
        transition: color 0.3s;
    }

    nav ul li a:hover {
        color: #b8d6f3;
    }

    /* Search Section */
    .search-section {
        background-color: #003580;
        padding: 30px 0;
        color: white;
    }

    .search-container {
        background-color: #febb02;
        border-radius: 5px;
        padding: 20px;
        max-width: 800px;
        margin: 0 auto;
    }

    .search-title {
        color: #333;
        margin-bottom: 15px;
        font-size: 22px;
    }

    .search-form {
        display: flex;
        gap: 10px;
    }

    .search-input {
        flex: 1;
        padding: 12px;
        border: none;
        border-radius: 3px;
        font-size: 16px;
    }

    .search-btn {
        background-color: #0071c2;
        color: white;
        border: none;
        border-radius: 3px;
        padding: 0 25px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 600;
        transition: background-color 0.3s;
    }

    .search-btn:hover {
        background-color: #00487a;
    }

    /* Search Info */
    .search-info {
        background: white;
        padding: 20px;
        margin: 20px 0;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    a{
        color: #00487a;
    }

    .search-details {
        display: flex;
        gap: 30px;
        flex-wrap: wrap;
    }

    .search-detail {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .search-detail i {
        color: #0071c2;
    }

    /* Main Content */
    .main-content {
        display: flex;
        margin: 30px 0;
        gap: 30px;
    }

    /* Filters Sidebar */
    .filters {
        flex: 0 0 280px;
        background-color: white;
        border-radius: 5px;
        padding: 20px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        height: fit-content;
        position: sticky;
        top: 20px;
    }

    .filter-section {
        margin-bottom: 25px;
        padding-bottom: 20px;
        border-bottom: 1px solid #eee;
    }

    .filter-section:last-child {
        border-bottom: none;
    }

    .filter-title {
        font-size: 18px;
        margin-bottom: 15px;
        color: #333;
        font-weight: 600;
    }

    .filter-options {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .filter-option {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .filter-option input {
        width: 18px;
        height: 18px;
        cursor: pointer;
    }

    .filter-option label {
        cursor: pointer;
        font-size: 14px;
    }

    .star-rating {
        color: #ffb700;
        font-size: 14px;
    }

    /* Results Section */
    .results {
        flex: 1;
    }

    .results-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .results-title {
        font-size: 24px;
        font-weight: 600;
    }

    .results-count {
        color: #666;
        font-size: 16px;
        margin-top: 5px;
    }

    .sort-options {
        display: flex;
        gap: 10px;
        align-items: center;
    }

    .sort-select {
        padding: 10px 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
        background-color: white;
        font-size: 14px;
        cursor: pointer;
    }

    .map-toggle {
        display: flex;
        align-items: center;
        gap: 8px;
        background-color: #0071c2;
        color: white;
        border: none;
        border-radius: 5px;
        padding: 10px 20px;
        cursor: pointer;
        font-weight: 500;
        transition: background-color 0.3s;
    }

    .map-toggle:hover {
        background-color: #00487a;
    }

    /* Hotel List - UPDATED SECTION */
    .hotel-list {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .hotel-card {
        background-color: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        display: flex;
        transition: transform 0.3s, box-shadow 0.3s;
    }

    .hotel-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 4px 15px rgba(0,0,0,0.15);
    }

    .hotel-image {
        flex: 0 0 300px;
        height: 220px;
        position: relative;
        overflow: hidden;
    }

    .hotel-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s;
    }

    .hotel-card:hover .hotel-image img {
        transform: scale(1.05);
    }

    /* UPDATED: Hotel info section to match your JS output */
    .hotel-info {
        flex: 1;
        padding: 20px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }

    .hotel-name {
        font-size: 22px;
        font-weight: 600;
        margin-bottom: 5px;
        color: #0071c2;
    }

    .hotel-location {
        color: #666;
        margin-bottom: 10px;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .hotel-rating {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: 10px;
    }

    .rating-badge {
        background-color: #003580;
        color: white;
        padding: 6px 10px;
        border-radius: 6px;
        font-weight: 600;
        font-size: 14px;
    }

    .rating-text {
        font-size: 14px;
        color: #666;
        font-weight: 500;
    }

    .review-count {
        font-size: 14px;
        color: #666;
    }

    /* UPDATED: Hotel pricing section to match your JS output */
    .hotel-pricing {
        flex: 0 0 200px;
        padding: 20px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: flex-end;
        border-left: 1px solid #eee;
    }

    .price-container {
        text-align: right;
    }

    .price-label {
        display: block;
        font-size: 12px;
        color: #666;
        margin-bottom: 5px;
    }

    .price {
        font-size: 28px;
        font-weight: 700;
        color: #333;
        margin-bottom: 5px;
    }

    /* UPDATED: View button to match your JS output */
    .view-btn {
        background-color: #0071c2;
        color: white;
        border: none;
        border-radius: 5px;
        padding: 12px 20px;
        cursor: pointer;
        font-weight: 600;
        transition: background-color 0.3s;
        font-size: 14px;
        width: 100%;
    }

    .view-btn:hover {
        background-color: #00487a;
    }

    /* Keep existing styles for backward compatibility */
    .hotel-details {
        flex: 1;
        padding: 20px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }

    .hotel-features {
        display: flex;
        gap: 8px;
        margin-bottom: 15px;
        flex-wrap: wrap;
    }

    .feature {
        background-color: #f0f8ff;
        color: #0071c2;
        padding: 4px 10px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 500;
    }

    .hotel-description {
        color: #555;
        margin-bottom: 15px;
        font-size: 14px;
        line-height: 1.5;
    }

    .rating-score {
        background-color: #003580;
        color: white;
        padding: 6px 10px;
        border-radius: 6px;
        font-weight: 600;
        font-size: 14px;
    }

    .hotel-price {
        text-align: right;
    }

    .price-amount {
        font-size: 28px;
        font-weight: 700;
        color: #333;
        margin-bottom: 5px;
    }

    .price-period {
        font-size: 14px;
        color: #666;
        margin-bottom: 10px;
    }

    .tax-info {
        font-size: 12px;
        color: #666;
        margin-bottom: 10px;
    }

    .availability-btn {
        background-color: #0071c2;
        color: white;
        border: none;
        border-radius: 5px;
        padding: 12px 20px;
        cursor: pointer;
        font-weight: 600;
        transition: background-color 0.3s;
        font-size: 14px;
    }

    .availability-btn:hover {
        background-color: #00487a;
    }

    /* Loading States - UPDATED */
    .loading-container {
        text-align: center;
        padding: 60px 20px;
    }

    .loading-spinner {
        display: inline-block;
        width: 50px;
        height: 50px;
        border: 5px solid rgba(0, 0, 0, 0.1);
        border-radius: 50%;
        border-top-color: #0071c2;
        animation: spin 1s ease-in-out infinite;
        margin-bottom: 20px;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    .error-container {
        text-align: center;
        padding: 40px 20px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .error-message {
        color: #e74c3c;
        margin-bottom: 20px;
        font-size: 18px;
        text-align: center;
        padding: 40px 20px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .error-message i {
        font-size: 48px;
        margin-bottom: 15px;
        color: #e74c3c;
    }

    .error-message h3 {
        margin-bottom: 10px;
        color: #333;
    }

    .error-message p {
        margin-bottom: 20px;
        color: #666;
    }

    .retry-btn {
        background-color: #0071c2;
        color: white;
        border: none;
        border-radius: 5px;
        padding: 10px 20px;
        cursor: pointer;
        font-weight: 600;
    }

    .no-results {
        text-align: center;
        padding: 40px 20px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        color: #666;
        font-size: 18px;
    }

    /* Footer */
    footer {
        background-color: #d6d6d6;
        color: white;
        padding: 40px 0 20px;
        margin-top: 50px;
        color: black !important;
    }

    .footer-content {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 30px;
    }

    .footer-section {
        flex: 1;
        min-width: 200px;
    }

    .footer-title {
        font-size: 18px;
        margin-bottom: 15px;
        font-weight: 600;
    }

    .footer-links {
        list-style: none;
    }

    .footer-links li {
        margin-bottom: 8px;
    }

    .footer-links a {
        color: #b8d6f3;
        text-decoration: none;
        transition: color 0.3s;
        font-size: 14px;
    }

    .footer-links a:hover {
        color: white;
    }

    .copyright {
        text-align: center;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #00487a;
        color: #b8d6f3;
        font-size: 14px;
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
        .main-content {
            flex-direction: column;
        }
        
        .filters {
            flex: 1;
            position: static;
        }
    }

    @media (max-width: 768px) {
        .hotel-card {
            flex-direction: column;
        }
        
        .hotel-image {
            flex: 1;
            height: 200px;
        }
        
        .hotel-pricing {
            border-left: none;
            border-top: 1px solid #eee;
            flex: 1;
            align-items: stretch;
        }
        
        .results-header {
            flex-direction: column;
            gap: 15px;
            align-items: flex-start;
        }
        
        .search-form {
            flex-direction: column;
        }
    }

    @media (max-width: 480px) {
        .header-content {
            flex-direction: column;
            gap: 15px;
        }
        
        nav ul {
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .search-details {
            flex-direction: column;
            gap: 15px;
        }
        
        .hotel-pricing {
            flex: 0 0 auto;
        }
    }
</style>
</head>
<body>
    <!-- Header -->
 <header>
        <div class="container">
            <div class="header-content">
                <a href="index.html" class="logo">TravelBook</a>
               
             
            </div>
        </div>
    </header>

    <!-- Search Section -->
    <section style="display: none;" class="search-section">
        <div class="container">
            <div class="search-container">
                <h2 class="search-title">Find your perfect stay</h2>
                <form class="search-form" id="search-form">
                    <input type="text" class="search-input" id="destination-search" placeholder="Where are you going?">
                    <button type="submit" class="search-btn">Search</button>
                </form>
            </div>
        </div>
    </section>

    <!-- Search Info -->
    <div class="container">
        <div class="search-info">
            <div class="search-details" id="search-details">
                <!-- Search details will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container">
        <div class="main-content">
            <!-- Filters Sidebar -->
            <aside class="filters">
                <div class="filter-section">
                    <h3 class="filter-title">Filter by:</h3>
                </div>
                
                <div class="filter-section">
                    <h3 class="filter-title">Star Rating</h3>
                    <div class="filter-options">
                        <div class="filter-option">
                            <input type="checkbox" id="rating-5" data-rating="5">
                            <label for="rating-5">
                                <span class="star-rating">★★★★★</span> 5 stars
                            </label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="rating-4" data-rating="4">
                            <label for="rating-4">
                                <span class="star-rating">★★★★☆</span> 4 stars
                            </label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="rating-3" data-rating="3">
                            <label for="rating-3">
                                <span class="star-rating">★★★☆☆</span> 3 stars
                            </label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="rating-2" data-rating="2">
                            <label for="rating-2">
                                <span class="star-rating">★★☆☆☆</span> 2 stars
                            </label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="rating-1" data-rating="1">
                            <label for="rating-1">
                                <span class="star-rating">★☆☆☆☆</span> 1 star
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="filter-section">
                    <h3 class="filter-title">Property Type</h3>
                    <div class="filter-options">
                        <div class="filter-option">
                            <input type="checkbox" id="type-hotel" data-type="hotel">
                            <label for="type-hotel">Hotels</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="type-apartment" data-type="apartment">
                            <label for="type-apartment">Apartments</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="type-resort" data-type="resort">
                            <label for="type-resort">Resorts</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="type-villa" data-type="villa">
                            <label for="type-villa">Villas</label>
                        </div>
                    </div>
                </div>
                
                <div class="filter-section">
                    <h3 class="filter-title">Review Score</h3>
                    <div class="filter-options">
                        <div class="filter-option">
                            <input type="checkbox" id="score-9" data-score="9">
                            <label for="score-9">Wonderful 9+</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="score-8" data-score="8">
                            <label for="score-8">Very Good 8+</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="score-7" data-score="7">
                            <label for="score-7">Good 7+</label>
                        </div>
                    </div>
                </div>

                <div class="filter-section">
                    <h3 class="filter-title">Price Range</h3>
                    <div class="filter-options">
                        <div class="filter-option">
                            <input type="checkbox" id="price-1" data-price="0-100">
                            <label for="price-1">Under $100</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="price-2" data-price="100-200">
                            <label for="price-2">$100 - $200</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="price-3" data-price="200-300">
                            <label for="price-3">$200 - $300</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="price-4" data-price="300-500">
                            <label for="price-4">$300 - $500</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="price-5" data-price="500-1000">
                            <label for="price-5">$500 - $1000</label>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Results Section -->
            <section class="results">
                <div class="results-header">
                    <div>
                        <h1 class="results-title" id="results-title">Search Results</h1>
                        <p class="results-count" id="results-count">Loading hotels...</p>
                    </div>
                    <div class="sort-options">
                        <select class="sort-select" id="sort-select">
                            <option value="recommended">Our top picks</option>
                            <option value="price_asc">Lowest Price First</option>
                            <option value="price_desc">Highest Price First</option>
                            <option value="rating_desc">Top reviewed</option>
                            <option value="stars_desc">Star rating (high to low)</option>
                            <option value="stars_asc">Star rating (low to high)</option>
                        </select>
                        
                    </div>
                </div>

                <!-- Hotel List -->
                <div class="hotel-list" id="hotel-list">
                    <div class="loading-container">
                        <div class="loading-spinner"></div>
                        <p>Loading hotels...</p>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>About</h3>
                    <div class="footer-links">
                        <a href="#">How TravelBook works</a>
                        <a href="#">Newsroom</a>
                        <a href="#">Careers</a>
                        <a href="#">Investors</a>
                    </div>
                </div>
                <div class="footer-column">
                     
                </div>
                <div class="footer-column">
                    
                </div>
                <div class="footer-column">
                     
                </div>
                <div class="footer-column">
                    
                </div>
            </div>
            <div class="footer-bottom">
               
            </div>
        </div>
    </footer>

   
    <script>
        // Wait for DOM to be fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing search...');
            
            // Check if required elements exist
            const hotelList = document.getElementById('hotel-list');
            const sortSelect = document.getElementById('sort-select');
            const resultsCount = document.getElementById('results-count');
            const resultsTitle = document.getElementById('results-title');
            
            if (!hotelList) {
                console.error('hotel-list element not found');
                return;
            }
            
            if (!sortSelect) {
                console.error('sort-select element not found');
                return;
            }
            
            // Check if API config is loaded
            if (typeof API_CONFIG === 'undefined' || typeof API_KEY === 'undefined') {
                console.error('API configuration not loaded. Make sure config.js is included.');
                hotelList.innerHTML = '<div class="error-message">Configuration error. Please check console.</div>';
                return;
            }
            
            console.log('API Config loaded:', API_CONFIG);
            
            // Initialize SearchService
            let searchService;
            try {
                searchService = new SearchService();
                console.log('SearchService initialized');
            } catch (error) {
                console.error('Error initializing SearchService:', error);
                hotelList.innerHTML = '<div class="error-message">Failed to initialize search service.</div>';
                return;
            }
            
            // Get URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const destination = urlParams.get('destination');
            const destId = urlParams.get('dest_id');
            const checkIn = urlParams.get('check_in');
            const checkOut = urlParams.get('check_out');
            const guests = urlParams.get('guests');
            
            console.log('Search params:', { destination, destId, checkIn, checkOut, guests });
            
            // Update page title
            if (resultsTitle && destination) {
                resultsTitle.textContent = `Hotels in ${destination}`;
            }
            
            let allHotels = [];
            
            // Fetch hotels
            async function fetchHotels() {
                try {
                    if (!destId) {
                        throw new Error('Destination ID is required');
                    }
                    
                    hotelList.innerHTML = '<div class="loading-container"><div class="loading-spinner"></div><p>Searching for hotels...</p></div>';
                    
                    const searchParams = {
                        arrival_date: checkIn || '2025-12-20',
                        departure_date: checkOut || '2025-12-25',
                        adults: parseInt(guests) || 1
                    };
                    
                    console.log('Fetching hotels with params:', searchParams);
                    
                    const response = await searchService.searchHotels(destId, searchParams);
                    console.log('Search response:', response);
                    
                    if (response && response.data && response.data.hotels) {
                        allHotels = response.data.hotels;
                        displayHotels(allHotels);
                        
                        if (resultsCount) {
                            resultsCount.textContent = `${allHotels.length} properties found`;
                        }
                    } else {
                        throw new Error('No hotels found in response');
                    }
                } catch (error) {
                    console.error('Error fetching hotels:', error);
                    hotelList.innerHTML = `
                        <div class="error-message">
                            <i class="fas fa-exclamation-triangle"></i>
                            <h3>Unable to load hotels</h3>
                            <p>${error.message}</p>
                            <button onclick="location.reload()" class="retry-btn">Try Again</button>
                        </div>
                    `;
                }
            }
            
            // Display hotels
            function displayHotels(hotels) {
                if (!hotels || hotels.length === 0) {
                    hotelList.innerHTML = '<div class="no-results">No hotels found matching your criteria.</div>';
                    return;
                }
                
                hotelList.innerHTML = hotels.map(hotel => {
                    const prop = hotel.property || hotel;
                    const price = prop.priceBreakdown?.grossPrice?.value || 0;
                    const currency = prop.priceBreakdown?.grossPrice?.currency || 'USD';
                    const reviewScore = prop.reviewScore || 0;
                    const reviewWord = prop.reviewScoreWord || 'Good';
                    const reviewCount = prop.reviewCount || 0;
                    const photoUrl = prop.photoUrls?.[0] || 'placeholder.jpg';
                    
                    return `
                        <div class="hotel-card" data-hotel-id="${prop.id || hotel.hotel_id}">
                            <div class="hotel-image">
                                <img src="${photoUrl}" alt="${prop.name}" onerror="this.src='https://via.placeholder.com/300x200?text=No+Image'">
                            </div>
                            <div class="hotel-info">
                                <h3 class="hotel-name">${prop.name}</h3>
                                <div class="hotel-location">
                                    <i class="fas fa-map-marker-alt"></i>
                                    ${prop.wishlistName || destination || 'Location'}
                                </div>
                                <div class="hotel-rating">
                                    <span class="rating-badge">${reviewScore.toFixed(1)}</span>
                                    <span class="rating-text">${reviewWord}</span>
                                    <span class="review-count">(${reviewCount} reviews)</span>
                                </div>
                            </div>
                            <div class="hotel-pricing">
                                <div class="price-container">
                                    <span class="price-label">Price per night</span>
                                    <span class="price">${currency} ${price.toFixed(2)}</span>
                                </div>
                                <button class="view-btn" onclick="viewHotel('${prop.id || hotel.hotel_id}')">
                                    View Details
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            // Sort hotels
            if (sortSelect) {
                sortSelect.addEventListener('change', function() {
                    const sortValue = this.value;
                    let sortedHotels = [...allHotels];
                    
                    switch(sortValue) {
                        case 'price_asc':
                            sortedHotels.sort((a, b) => 
                                (a.property?.priceBreakdown?.grossPrice?.value || 0) - 
                                (b.property?.priceBreakdown?.grossPrice?.value || 0)
                            );
                            break;
                        case 'price_desc':
                            sortedHotels.sort((a, b) => 
                                (b.property?.priceBreakdown?.grossPrice?.value || 0) - 
                                (a.property?.priceBreakdown?.grossPrice?.value || 0)
                            );
                            break;
                        case 'rating_desc':
                            sortedHotels.sort((a, b) => 
                                (b.property?.reviewScore || 0) - (a.property?.reviewScore || 0)
                            );
                            break;
                    }
                    
                    displayHotels(sortedHotels);
                });
            }
            
            // Initialize filters
            const filterCheckboxes = document.querySelectorAll('.filter-option input[type="checkbox"]');
            filterCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', applyFilters);
            });
            
            function applyFilters() {
                let filteredHotels = [...allHotels];
                
                // Filter by rating
                const selectedRatings = Array.from(document.querySelectorAll('[data-rating]:checked'))
                    .map(cb => parseInt(cb.dataset.rating));
                
                if (selectedRatings.length > 0) {
                    filteredHotels = filteredHotels.filter(hotel => 
                        selectedRatings.includes(Math.floor(hotel.property?.reviewScore || 0))
                    );
                }
                
                // Filter by review score
                const selectedScores = Array.from(document.querySelectorAll('[data-score]:checked'))
                    .map(cb => parseInt(cb.dataset.score));
                
                if (selectedScores.length > 0) {
                    filteredHotels = filteredHotels.filter(hotel => {
                        const score = hotel.property?.reviewScore || 0;
                        return selectedScores.some(minScore => score >= minScore);
                    });
                }
                
                // Filter by price range
                const selectedPrices = Array.from(document.querySelectorAll('[data-price]:checked'))
                    .map(cb => cb.dataset.price);
                
                if (selectedPrices.length > 0) {
                    filteredHotels = filteredHotels.filter(hotel => {
                        const price = hotel.property?.priceBreakdown?.grossPrice?.value || 0;
                        return selectedPrices.some(range => {
                            const [min, max] = range.split('-').map(Number);
                            return price >= min && price <= max;
                        });
                    });
                }
                
                displayHotels(filteredHotels);
                
                if (resultsCount) {
                    resultsCount.textContent = `${filteredHotels.length} of ${allHotels.length} properties`;
                }
            }
            
            // Start fetching hotels
            fetchHotels();
        });
        
        // Global function to view hotel details
        function viewHotel(hotelId) {
            const urlParams = new URLSearchParams(window.location.search);
            const checkIn = urlParams.get('check_in');
            const checkOut = urlParams.get('check_out');
            const guests = urlParams.get('guests');
            
            const detailsUrl = `hotel-details.html?hotel_id=${hotelId}&check_in=${checkIn}&check_out=${checkOut}&guests=${guests}`;
            window.location.href = detailsUrl;
        }
    </script>
</body>
</html>




